@startuml c4_context
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Context.puml
skinparam backgroundColor #FFFFFF
skinparam legendBackgroundColor #EEEBDC
skinparam legendBorderColor #2D3E50

skinparam linetype ortho
skinparam arrowColor #999
skinparam arrowThickness 1.2

title "Платформа Унифицированных Коммуникаций — Контекстная диаграмма системы"

' ============ АКТЁРЫ ============

Person(corpUser, "Корпоративный пользователь", "Сотрудник, агент, использующий UC-платформу")
Person(admin, "Администратор UC", "IT-администратор, управляющий системой")
Person(securityOfficer, "Офицер информационной безопасности", "Специалист по безопасности, контролирующий доступ и политики ИБ")
Person(externalUser, "Внешний пользователь", "Любой человек, подключающийся по ссылке через приложение или браузер")

' ============ СИСТЕМА UC PLATFORM ============

System(ucPlatform, "Платформа Унифицированных Коммуникаций", "UC Platform предоставляет голосовую связь, видео, чат, presence, интеграции с CRM/ERP")
System_Boundary(ucSystem, "UC Platform") {
    System(ucClients, "UC Clients", "Веб-клиент (WebRTC, WebTransport), мобильные приложения (iOS/Android), Desktop-клиенты")
    note right of ucClients
        Клиентские приложения:
        - Web-клиент (WebRTC, WebTransport)
        - Мобильные приложения (iOS/Android)
        - Desktop-клиенты
        
        Поддержка:
        - Голосовые/видео вызовы
        - Мгновенные сообщения
        - Presence и статусы
        - Интеграция с CRM/ERP
    end note
}

' ============ ВНЕШНИЕ СИСТЕМЫ ============

System_Ext(idp, "Identity Provider", "Active Directory, Okta, Azure AD — аутентификация и SSO")
System_Ext(crm, "CRM / ERP / Service Desk", "Salesforce, SAP, Jira — интеграция с бизнес-системами")
System_Ext(pstn, "PSTN / Операторская сеть", "Операторы фиксированной связи и мобильные операторы — голосовая связь через SIP-транки")
System_Ext(esmsgw, "Email/SMS/Push Gateway", "Система уведомлений — email, SMS, push-уведомления")
System_Ext(monitoring, "Системы мониторинга и ИБ", "SIEM, Security — наблюдаемость и безопасность")

' ============ ВЗАИМОДЕЙСТВИЯ ПОЛЬЗОВАТЕЛЕЙ ============

Rel(corpUser, ucClients, "Использует", "Голос/видео/чат, управление контактами")
Rel(admin, ucPlatform, "Администрирует", "Управление политиками, пользователями, маршрутизацией")
Rel(securityOfficer, ucPlatform, "Контролирует", "Мониторинг безопасности, аудит доступа, управление политиками ИБ")
Rel(externalUser, ucClients, "Подключается", "Подключение по ссылке через приложение или браузер")
Rel(externalUser, pstn, "Звонит", "Входящие вызовы в компанию")

' ============ КЛИЕНТСКИЕ ВЗАИМОДЕЙСТВИЯ ============

Rel(ucClients, ucPlatform, "Взаимодействует", "WebRTC / WebTransport / HTTPS\n(REST, WebSocket)\nРегистрация, сигналы вызовов,\nсообщения, presence")

' ============ ИНТЕГРАЦИИ С ВНЕШНИМИ СИСТЕМАМИ ============

Rel(ucPlatform, idp, "Аутентифицируется", "OIDC / SAML 2.0\nАутентификация и SSO,\nфедерация идентичности")
Rel(ucPlatform, crm, "Интегрируется", "REST / Webhook / Events\nИнтеграция с карточкой клиента,\nлогирование звонков,\nавтоматизация процессов")
Rel(ucPlatform, esmsgw, "Отправляет уведомления", "SMTP / HTTPS / Push API\nEmail/SMS/Push уведомления\nо звонках, сообщениях, событиях")
Rel(ucPlatform, monitoring, "Отправляет метрики", "Metrics / Logs / Traces\n(OpenTelemetry, Prometheus)\nНаблюдаемость и ИБ,\nмониторинг безопасности")
Rel(ucPlatform, pstn, "Инициирует вызовы", "SIP-транки через SBC\n(Session Border Controller)\nИсходящие вызовы")
Rel(pstn, ucPlatform, "Маршрутизирует входящие", "SIP-транки через SBC\nВходящие вызовы")

' ============ ПРИМЕЧАНИЯ ============

note right of ucPlatform
    Граница системы «UC Platform» включает:
    
    Микросервисы:
    - Сигнализация (Call Control, SIP Gateway)
    - Медиа (WebRTC Gateway, Media Server)
    - Presence и Messaging
    - Биллинг и CDR
    - Provisioning и IAM
    - Observability Stack
    
    Архитектурные принципы:
    - Микросервисная архитектура
    - Event-driven коммуникации
    - Real-time обработка (WebRTC, WebTransport)
    - Горизонтальное масштабирование
    - Отказоустойчивость (HA)
end note

note bottom of idp
    Identity Provider обеспечивает:
    - Единый вход (SSO)
    - Федерацию идентичности
    - MFA (многофакторная аутентификация)
    - Управление пользователями
end note

note bottom of crm
    Интеграция с CRM/ERP позволяет:
    - Автоматически открывать карточку клиента
      при входящем звонке
    - Логировать коммуникации в CRM
    - Инициировать вызовы из CRM
    - Синхронизировать контакты
end note

note bottom of pstn
    PSTN интеграция через SBC:
    - Безопасная маршрутизация SIP-трафика
    - Нормализация сигнализации
    - Защита от атак (DDoS, SIP-флуд)
    - Транскодирование кодеков
end note

SHOW_LEGEND()

@enduml
