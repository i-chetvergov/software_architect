@startuml c4_context
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Context.puml

skinparam backgroundColor #FFFFFF
skinparam legendBackgroundColor #EEEBDC
skinparam legendBorderColor #2D3E50

skinparam linetype ortho
skinparam arrowColor #999
skinparam arrowThickness 1.2
skinparam shadowing false
skinparam defaultTextAlignment center
left to right direction

title "Платформа Унифицированных Коммуникаций — Контекстная диаграмма системы"

' ==========================================================
' АКТЁРЫ
' ==========================================================
Person(corpUser, "Корпоративный пользователь", "Сотрудник/агент, использующий UC-платформу")
Person(admin, "Администратор UC", "IT-администратор, управляющий системой")
Person(securityOfficer, "Офицер информационной безопасности", "Контроль доступа, политик ИБ и аудит")
Person(externalUser, "Внешний пользователь", "Подключение по ссылке через приложение/браузер или звонок с внешней сети")

' ==========================================================
' СИСТЕМА UC PLATFORM (уровень контекста)
' ВАЖНО: UC Clients — внешние клиенты (за пределами границы платформы).
' ==========================================================
System(ucPlatform, "UC Platform", "Унифицированные коммуникации: телефония (SIP/WebRTC), голосовые конференции, чаты, presence, интеграции, безопасность и наблюдаемость")

System_Ext(ucClients, "UC Clients", "Web (WebRTC/WebTransport), Mobile (iOS/Android), Desktop-клиенты")

note right of ucClients
	Клиентские приложения:
	- Web-клиент (WebRTC/WebTransport)
	- Мобильные приложения (iOS/Android)
	- Desktop-клиенты

	Основные возможности:
	- Голосовые вызовы и конференции
	- Текстовый чат
	- Presence/статусы
	- Подключение внешних участников по ссылке
end note

' ==========================================================
' ВНЕШНИЕ СИСТЕМЫ
' ==========================================================
System_Ext(idp, "Identity Provider", "AD/Okta/Azure AD — аутентификация и SSO (OIDC/SAML)")
System_Ext(crm, "CRM / ERP / Service Desk", "Интеграции: карточка клиента, логирование коммуникаций, автоматизация")
System_Ext(pstn, "PSTN / Операторская сеть", "Операторская сеть — голосовая связь через SIP-транки (через SBC)")
System_Ext(esmsgw, "Email/SMS/Push Gateway", "Шлюз уведомлений: email/SMS/push")
System_Ext(monitoring, "Системы мониторинга и ИБ", "SIEM/SOC/Monitoring — сбор событий, метрик, аудит")

' Контекстный акцент по двум разработанным диаграммам:
' 1) Chat и Voice Conferencing — разные домены/нагрузки
System_Ext(externalMeetingUser, "Внешний участник конференции", "Подключается по ссылке (WebRTC) или как гость")

' ==========================================================
' ВЗАИМОДЕЙСТВИЯ ПОЛЬЗОВАТЕЛЕЙ
' ==========================================================
Rel(corpUser, ucClients, "Использует", "звонки/конференции/чат")
Rel(externalUser, ucClients, "Подключается", "по ссылке (web/app)")
Rel(externalMeetingUser, ucClients, "Подключается", "гостевое участие в конференции")

Rel(admin, ucPlatform, "Администрирует", "пользователи, маршрутизация, политики, конфигурации")
Rel(securityOfficer, ucPlatform, "Контролирует", "аудит, политики доступа (ABAC), инциденты ИБ")

Rel(externalUser, pstn, "Звонит", "входящие вызовы в компанию")

' ==========================================================
' КЛИЕНТСКИЕ ВЗАИМОДЕЙСТВИЯ С UC PLATFORM
' (на контексте показываем, что клиенты ходят в платформу разными протоколами)
' ==========================================================
Rel(ucClients, ucPlatform, "Взаимодействует", "HTTPS/REST, WebSocket, WebTransport, WebRTC (DTLS/SRTP)\nрегистрация, сигнализация, чат, presence, конференции")

' ==========================================================
' ИНТЕГРАЦИИ UC PLATFORM С ВНЕШНИМИ СИСТЕМАМИ
' ==========================================================
Rel(ucPlatform, idp, "Федерация идентичности / SSO", "OIDC / SAML 2.0\nMFA, единый вход, управление сессиями")
Rel(ucPlatform, crm, "Интеграции", "REST / Webhook / Events\nкарточка клиента, логирование звонков/чатов, автоматизация")
Rel(ucPlatform, esmsgw, "Уведомления", "SMTP / HTTPS / Push API\nemail/SMS/push о событиях")
Rel(ucPlatform, monitoring, "Наблюдаемость и ИБ", "Metrics / Logs / Traces + Audit\n(OpenTelemetry/экспорт в SIEM)")

' PSTN: показываем периметровую доверенную связность (не user-auth, а SBC policy)
Rel(ucPlatform, pstn, "SIP-транки через SBC", "SIP over TLS (mTLS) + ACL/Policy\nисходящие вызовы")
Rel(pstn, ucPlatform, "SIP-транки через SBC", "SIP over TLS (mTLS) + ACL/Policy\nвходящие вызовы")

' ==========================================================
' ПРИМЕЧАНИЯ (обновлено под 2 разработанные диаграммы: containers + components)
' ==========================================================
note right of ucPlatform
	Граница системы «UC Platform» включает ключевые домены:

	- Сигнализация: Call Control, WebRTC/SIP шлюзы
	- Медиа: обработка/запись, поддержка конференций
	- Presence
	- Messaging (чат) — отдельный домен
	- Voice Conferencing — отдельный домен
	- Монетизация/CDR
	- Provisioning
	- Наблюдаемость (метрики/логи/трейсы/аудит)
	- Политики доступа (ABAC): PDP (OPA/REGO)

	Принципы:
	- Микросервисы + event-driven
	- Real-time контур (WebRTC/WebTransport)
	- Горизонтальное масштабирование
	- Отказоустойчивость (HA)
end note

note bottom of idp
	Identity Provider:
	- SSO/федерация (OIDC/SAML)
	- MFA
	- управление пользователями/группами (в зависимости от внедрения)
end note

note bottom of pstn
	PSTN интеграция через SBC:
	- SIP over TLS (mTLS), IP ACL, policy
	- нормализация и interop
	- защита от атак (SIP-flood/DDoS)
	- (опционально) транскодирование кодеков
end note

note bottom of crm
	CRM/ERP интеграции:
	- открытие карточки клиента по вызову
	- логирование коммуникаций
	- инициирование вызовов из CRM
	- синхронизация контактов (если требуется)
end note

SHOW_LEGEND()
@enduml