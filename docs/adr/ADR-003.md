### ADR-003. Выбор хранилищ (OLTP/NoSQL/Time-series) и распределение данных

- **Статус**: Принято

#### Контекст

UC-платформа оперирует различными типами данных: транзакционные (пользователи, конфигурация, номера), высокообъёмные журналы CDR, медиаданные записей, телеметрия (метрики, логи, трейсы). Необходимо определить, какие типы хранилищ использовать и как распределить данные между ними с учётом драйверов **AD-01**, **AD-02**, **AD-05**, **AD-07**.

#### Решение

- **OLTP реляционная СУБД**:
  - Используется для хранения транзакционных данных: пользователи, роли, настройки UC-сервисов, конфигурация маршрутизации, данные provisioning.
  - Основные потребители: `IAM`, `Provisioning`, `Call Control`, `Chat`, `Presence`, `Billing`.
- **Специализированное хранилище CDR**:
  - Отдельная БД (реляционная или колоночная), оптимизированная под аналитические запросы по CDR и отчётность.
  - Используется `Billing/CDR Service` и внешние аналитические системы.
- **Object Storage**:
  - Используется для хранения медиазаписей (записи разговоров, конференций).
  - Управление метаданными и доступом осуществляет `Media/Recording Service` и `Billing/CDR`.
- **Time-series / observability хранилища**:
  - Метрики — в time-series БД (Prometheus/TSDB).
  - Логи — в log-ориентированном хранилище (Loki/ELK).
  - Трейсы — в специализированном backend (Tempo/Jaeger).

Диаграмма `deployment.puml` отражает логическое расположение этих хранилищ и их связи с сервисами.

Связь с артефактами:

- Архитектурные драйверы: **AD-01**, **AD-02**, **AD-05**, **AD-07**.
- Диаграммы: `c4_containers.puml`, `deployment.puml`.
- Разделы решения: `09_solution/index.md` (подсистема данных и аналитики).

#### Альтернативы

- Единая реляционная БД для всех типов данных.
  - Плюсы: упрощённое администрирование.
  - Минусы: слабое масштабирование, сложность оптимизации под разные типы нагрузок.
- Полная ориентация на NoSQL:
  - Плюсы: гибкость схемы для некоторых доменов.
  - Минусы: сложность транзакционности, ограниченный опыт в команде, риски при отчётности и консистентности.

#### Последствия

- Положительные:
  - Возможность масштабировать хранилища независимо по типам нагрузки.
  - Оптимизация производительности для конкретных сценариев (OLTP vs аналитика vs медиаданные).
- Отрицательные:
  - Усложнение ландшафта данных и требований к компетенциям эксплуатации.
  - Необходимость унифицированных политик резервного копирования, восстановления и retention для разных хранилищ.

