- **Статус**: Принято

#### Контекст

Для обеспечения управляемости и быстрой локализации инцидентов UC-платформа должна предоставлять достаточный уровень наблюдаемости (драйвер **AD-05**), а также поддерживать анализ производительности и соответствие SLO/SLA (AD-01, AD-02). Необходимо определить подход к метрикам, логам и распределённым трассировкам.

#### Решение

- Вводится единая **корреляция запросов по trace-id**:
  - `API Gateway` генерирует или принимает входящий `trace-id` и прокидывает его во все вызовы к backend-сервисам.
  - Все микросервисы логируют события с `trace-id` и `span-id`.
- **Метрики**:
  - Каждый сервис публикует технические и бизнес-метрики (количество вызовов, ошибки, latency, concurrent calls, TPS).
  - Метрики собираются time-series backend'ом (Prometheus/TSDB) и визуализируются в дашбордах.
- **Логи**:
  - Применяется централизованная система логирования (Loki/ELK); логи содержат контекст (service, instance, userId, callId, trace-id).
  - Логи ИБ дополнительно экспортируются в SIEM.
- **Трейсы**:
  - Для ключевых путей (установка вызова, аутентификация, входящий вызов) включаются распределённые трассировки (OpenTelemetry).
  - Backend трассировок (Tempo/Jaeger) интегрирован с дашбордами.

Диаграммы `deployment.puml` и `sequences.puml` демонстрируют места генерации метрик/логов/трейсов по основным сценариям.

Связь с артефактами:

- Архитектурные драйверы: **AD-01**, **AD-02**, **AD-05**, **AD-06**.
- Диаграммы: `deployment.puml`, `sequences.puml`.
- Разделы решения: `09_solution/index.md` (подсистема наблюдаемости).

#### Альтернативы

- Локальные логи без централизованной системы.
  - Плюсы: минимальные начальные затраты.
  - Минусы: сложная диагностика инцидентов, отсутствие единой картины.
- Только метрики без трассировок.
  - Плюсы: проще внедрить.
  - Минусы: затруднён анализ распределённых задержек и узких мест.

#### Последствия

- Положительные:
  - Сокращение времени локализации инцидентов (поддержка сценария QA-04).
  - Возможность управления SLO/SLA по наблюдаемым показателям.
- Отрицательные:
  - Увеличение затрат на инфраструктуру и хранение телеметрии.
  - Необходимость настройки и поддержки стандартов логирования и метрик между командами.

