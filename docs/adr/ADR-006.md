### ADR-006. HA/Failover стратегии и SLO для UC-платформы

- **Статус**: Принято

#### Контекст

Коммуникационные сервисы критичны для бизнеса; требуется обеспечить высокую доступность (SLA ≥ 99.9 %) и предсказуемое восстановление после сбоев (драйверы **AD-01**, **AD-02**, **AD-05**). Необходимо определить подход к отказоустойчивости и целевым SLO.

#### Решение

- **Уровень приложений**:
  - Все ключевые микросервисы (API Gateway, Call Control, IAM, SIP/WebRTC Gateway, Chat, Media/Recording, Billing, Notify) разворачиваются с минимум двумя репликами в разных узлах кластера.
  - Используется стратегия деплоя `rolling update` с возможностью `canary` для чувствительных сервисов.
- **Уровень данных**:
  - OLTP и CDR БД используют репликацию master/replica или кластерные конфигурации с автоматическим failover.
  - Объектное хранилище для записей поддерживает избыточное хранение (минимум 3 копии в пределах зоны).
- **Сетевой уровень**:
  - Входящий трафик идёт через отказоустойчивый ingress/load balancer.
  - Для SIP-транков используется резервирование SBC/шлюзов (актив-актив или актив-пассив).
- **SLO**:
  - Время восстановления сервисов при отказе узла кластера — не более 5 минут (QA-02, QA-09).
  - Доля неуспешных установлений вызовов в минуту при обновлениях — менее 0.5 % (QA-06).

Связь с артефактами:

- Архитектурные драйверы: **AD-01**, **AD-02**, **AD-05**.
- Диаграммы: `c4_containers.puml`, `deployment.puml`.
- Разделы решения: `09_solution/index.md` (стратегии HA/DR).

#### Альтернативы

- Единичные инстансы без реплик и без чёткой стратегии failover.
  - Плюсы: низкая стоимость.
  - Минусы: недопустимые простои и высокий риск потери данных.

#### Последствия

- Положительные:
  - Повышенная устойчивость к отказам отдельных компонентов и узлов.
  - Возможность плановых обновлений без заметного влияния на пользователей.
- Отрицательные:
  - Рост инфраструктурных затрат (дополнительные реплики, резервные компоненты).
  - Усложнение архитектуры и эксплуатационных процессов.

