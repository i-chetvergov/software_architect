# Database Diagram

![Database Diagram](../assets/diagrams/database_diagram.svg)

## Назначение диаграммы

Диаграмма баз данных описывает логическую структуру хранилищ данных UC-платформы на уровне таблиц, их полей и связей. Диаграмма отражает разделение данных по доменам и выбор типов хранилищ (реляционные и нереляционные).

## Структура баз данных

### DB_ACCOUNTS (PostgreSQL)
**Домен: Аккаунты и профили**

- **accounts** — учетные записи пользователей (email, пароль, статус)
- **user_profiles** — профили пользователей (имя, телефон, часовой пояс, статус presence)
- **user_devices** — зарегистрированные устройства (web, mobile, desktop, SIP)
- **feature_flags** — конфигурация и feature-флаги системы
- **routing_rules** — правила маршрутизации входящих вызовов

### DB_CALLS (PostgreSQL)
**Домен: Сигнализация и вызовы**

- **call_sessions** — сессии вызовов (активные и завершённые)
- **call_legs** — ноги вызова (участники соединения)
- **call_routing** — история попыток маршрутизации вызова
- **call_queues** — очереди для входящих вызовов
- **queue_members** — участники очередей (операторы)

### DB_CDR (PostgreSQL)
**Домен: CDR и биллинг**

- **cdr_records** — детализация вызовов (Call Detail Records)
- **billing_plans** — тарифные планы для биллинга
- **account_billing** — биллинговые данные аккаунтов

### DB_MESSAGING (PostgreSQL)
**Домен: Сообщения и presence**

- **conversations** — беседы (диалоги, группы, каналы)
- **conversation_participants** — участники бесед
- **messages** — сообщения в беседах
- **presence_status** — статусы presence пользователей
- **presence_subscriptions** — подписки на изменения presence

## Дополнительные хранилища

- **Redis** — кэширование сессий, токенов, presence, активных чатов
- **Object Storage (S3-совместимое)** — хранение записей разговоров и медиа-файлов

## Архитектурный смысл

Диаграмма демонстрирует:

- **Разделение по доменам** — каждая БД отвечает за свой домен (аккаунты, вызовы, биллинг, messaging)
- **Выбор хранилищ** — PostgreSQL для структурированных данных, Redis для кэша, Object Storage для медиа
- **Связи между доменами** — логические внешние ключи на уровне приложения, а не физические ограничения
- **Масштабируемость** — разделение позволяет независимо масштабировать каждую БД
- **Изоляция данных** — чувствительные данные (аккаунты, биллинг) изолированы от операционных данных (вызовы, messaging)

Диаграмма поддерживает архитектурные драйверы **AD-01**, **AD-03**, **AD-05** и решения из ADR-003, ADR-010.
