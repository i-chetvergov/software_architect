### Диаграммы архитектуры UC-платформы

Данный раздел описывает архитектурные диаграммы платформы унифицированных коммуникаций и связывает их с архитектурными драйверами и ADR.

#### C4 Context Diagram (`c4_context.puml`)

Диаграмма контекста отражает:

- границу системы `UC Platform` по отношению к корпоративным пользователям, администраторам и внешним абонентам;
- основные внешние системы: `Identity Provider / IdP`, `CRM/ERP`, `PSTN/операторская сеть`, `Email/SMS Gateway`, системы мониторинга и ИБ;
- высокоуровневые потоки взаимодействий: WebRTC/HTTPS для клиентов, OIDC/SAML для аутентификации, SIP-транки для голосового трафика, REST/Webhook для интеграций.

Диаграмма реализована в файле `c4_context.puml` и логически поддерживает архитектурные драйверы **AD-02**, **AD-03**, **AD-04**, **AD-07** (см. раздел `4. Архитектурные драйверы`) и решения, зафиксированные в ADR-001, ADR-004, ADR-008.

#### C4 Container Diagram (`c4_containers.puml`)

Диаграмма контейнеров описывает микросервисную структуру UC-платформы, включая ключевые контейнеры:

- `API Gateway`, `IAM / Identity Service`, `Call Control Service`, `SIP Gateway / SBC`, `WebRTC Gateway`;
- `Presence Service`, `Messaging / Chat Service`, `Media / Recording Service`;
- `Provisioning Service`, `Billing / CDR Service`, `Notification Service`, `Observability Stack`.

На диаграмме явно указаны основные протоколы взаимодействия: **SIP**, **WebRTC**, **HTTPS/REST**, **gRPC**, **event-driven интеграции через брокер сообщений**, что отражает выбранный гибридный стиль синхронных и асинхронных коммуникаций. Диаграмма в `c4_containers.puml` поддерживает драйверы **AD-01**, **AD-02**, **AD-03**, **AD-04**, **AD-05**, **AD-06** и решения из ADR-001, ADR-002, ADR-003, ADR-004, ADR-005.

#### Deployment Diagram (`deployment.puml`)

Диаграмма развертывания моделирует целевое окружение UC-платформы:

- Kubernetes-кластер с пространствами имён для шлюзов (`uc-gateway`), бизнес-логики (`uc-core`), медиа-компонентов (`uc-media`) и наблюдаемости (`uc-observability`);
- ingress/load balancer, через который проходит клиентский HTTPS/WebRTC-трафик;
- размещение микросервисов, баз данных (`OLTP DB`, `CDR DB`), объектного хранилища записей и брокера сообщений;
- интеграции с внешними системами (IdP, CRM, Email/SMS Gateway, PSTN, Monitoring/SIEM).

В тексте диаграммы заложены допущения по отказоустойчивости (несколько реплик, auto-scaling, использование брокера для асинхронных операций) и масштабированию по горизонтали. Диаграмма в `deployment.puml` поддерживает драйверы **AD-01**, **AD-02**, **AD-05**, **AD-07** и решения, оформленные в ADR-002, ADR-003, ADR-005, ADR-006, ADR-009.

#### Sequence Diagrams (`sequences.puml`)

В файле `sequences.puml` описаны три ключевых сценария:

- **UC_Seq_Outgoing_Call** — исходящий голосовой вызов (WebRTC клиент → API Gateway → Call Control → WebRTC/SIP Gateway → PSTN), отражающий маршрутизацию, медиасоединения и генерацию CDR (связан с UC-01 и требованиями FR-02, FR-07, FR-08, NFR-01, NFR-02, NFR-03).
- **UC_Seq_Incoming_Call** — входящий вызов через SBC/шлюз, с участием очереди и Presence-сервиса (связан с UC-02 и требованиями FR-02, FR-05, FR-07, NFR-01, NFR-02).
- **UC_Seq_User_Auth_Token** — аутентификация пользователя и получение access token через OIDC-поток (связан с требованиями FR-01, NFR-04, NFR-09).

Эти диаграммы детализируют архитектурные решения по взаимодействию между контейнерами и демонстрируют, как архитектура удовлетворяет драйверам **AD-01**, **AD-02**, **AD-03**, **AD-04**, **AD-05**, а также ADR-002, ADR-004, ADR-006, ADR-008.

#### Связь с разделом «Архитектурное решение» и ADR

- Общие принципы разбиения на микросервисы и выбор протоколов описаны в разделе `9. Архитектурное решение` и подкреплены ADR-001, ADR-002, ADR-003.
- Выбор IAM/OIDC, mTLS и политики безопасности отражён в ADR-004 и проиллюстрирован на C4 Context, C4 Containers и диаграмме аутентификации.
- Стратегии HA/Failover, observability и работы с данными CDR/Recording раскрыты в ADR-005, ADR-006, ADR-009 и визуализированы на диаграмме развертывания и последовательностей вызовов.