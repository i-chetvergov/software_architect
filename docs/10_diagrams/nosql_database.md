# NoSQL Database Diagram

![NoSQL Database Diagram](../assets/diagrams/nosql_database.svg)

## Назначение диаграммы

Диаграмма нереляционных хранилищ описывает структуру и использование специализированных хранилищ данных UC-платформы, которые дополняют реляционные базы данных PostgreSQL. Диаграмма отражает выбор типов хранилищ для различных доменов данных и паттернов доступа.

## Структура нереляционных хранилищ

### Object Storage (S3-совместимое)
**Домен: Медиа-файлы и записи**

- **recording_bucket** — хранилище записей разговоров
  - Организация по структуре: `recordings/{call_id}/{session_id}/`
  - Классы хранения: standard, glacier, deep_archive
  - Lifecycle политики для автоматического архивирования
  
- **media_assets_bucket** — хранилище медиа-ассетов
  - Голосовые сообщения, файлы из чатов
  - Аватары пользователей, превью записей
  - Интеграция с CDN для ускорения доступа
  
- **object_metadata** — метаданные объектов (хранятся в PostgreSQL)
  - Каталогизация записей и медиа-файлов
  - Политики доступа и временные ссылки
  - Управление retention и lifecycle

### Redis (Key-Value Store)
**Домен: Кэш и временные данные**

- **session_cache** — кэш активных сессий вызовов
- **token_cache** — кэш токенов доступа
- **presence_cache** — кэш статусов presence
- **active_chats_cache** — кэш активных чатов
- **rate_limit_cache** — счётчики rate limiting

### Time-Series Database (Prometheus / TSDB)
**Домен: Метрики и телеметрия**

- **metrics_series** — системные метрики (вызовы, соединения, latency)
- **call_quality_metrics** — метрики качества вызовов (RTT, packet loss, jitter, MOS)

### Log Storage (Loki / Elasticsearch)
**Домен: Логи и аудит**

- **application_logs** — логи приложений с correlation_id для трассировки
- **audit_logs** — логи аудита безопасности (доступ к записям, административные действия)

### Trace Storage (Tempo / Jaeger)
**Домен: Распределённая трассировка**

- **trace_spans** — spans распределённой трассировки для анализа производительности

## Архитектурный смысл

Диаграмма демонстрирует:

- **Специализация хранилищ** — каждый тип хранилища оптимизирован под свой паттерн доступа:
  - Object Storage — для больших бинарных объектов (записи, медиа)
  - Redis — для быстрого доступа к часто читаемым данным
  - Time-Series — для временных рядов метрик
  - Log Storage — для структурированных логов
  - Trace Storage — для распределённой трассировки

- **Оптимизация производительности** — использование кэширования для снижения нагрузки на PostgreSQL

- **Compliance и retention** — политики хранения данных для соответствия требованиям аудита и compliance

- **Масштабируемость** — независимое масштабирование каждого типа хранилища

Диаграмма поддерживает архитектурные драйверы **AD-01**, **AD-03**, **AD-05** и решения из ADR-003, ADR-005, ADR-010.
