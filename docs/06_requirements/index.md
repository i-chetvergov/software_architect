# 6. Требования

**Проект:** Платформа унифицированных коммуникаций (Unified Communications, UC) для корпоративного использования

---

## Введение

Требования определяют функциональные и нефункциональные характеристики UC-платформы, необходимые для достижения бизнес-целей и удовлетворения потребностей стейкхолдеров. Требования служат основой для формирования сценариев использования, сценариев атрибутов качества и архитектурных решений.

---

## 6.1. Функциональные требования (FR)

| ID | Требование | Описание | Связь с бизнес-целями | Связь с диаграммами |
|----|------------|----------|----------------------|---------------------|
| **FR-01** | Управление пользователями и устройствами | Регистрация, управление профилями и устройствами, интеграция с корпоративными каталогами (AD/LDAP) | BG-01, BG-05 | C4 Containers (IAM Service) |
| **FR-02** | Голосовая связь и телефония | Исходящие и входящие голосовые вызовы через SIP-транки и WebRTC-клиентов, базовые функции телефонии | BG-01, BG-02 | C4 Containers, Sequence (UC_Seq_Outgoing_Call, UC_Seq_Incoming_Call) |
| **FR-03** | Видеоконференции и совместная работа | Многопользовательские аудио-/видеоконференции с совместным экраном и чатом конференции | BG-01, BG-02 | C4 Containers (Call Control, Media/Recording) |
| **FR-04** | Обмен сообщениями (чат) | Обмен текстовыми и мультимедийными сообщениями между пользователями и группами, история чатов и поиск | BG-01, BG-02 | C4 Containers (Messaging/Chat Service) |
| **FR-05** | Presence и статусы пользователей | Актуальная информация о статусе доступности пользователей и использование в маршрутизации вызовов и сообщений | BG-01, BG-02 | C4 Containers (Presence Service) |
| **FR-06** | Интеграция с бизнес-системами | API/вебхуки для интеграции с CRM, Service Desk, ERP (отображение карточки клиента, клик-ту-колл, логирование) | BG-02, BG-07 | C4 Context, C4 Containers (API Gateway) |
| **FR-07** | Запись разговоров и хранение записей | Запись голосовых вызовов и конференций с хранением и управлением доступом к записям | BG-05, BG-08 | C4 Containers (Media/Recording Service) |
| **FR-08** | Биллинг и CDR | Сбор CDR-записей по всем сеансам связи и предоставление данных для биллинга и аналитики | BG-03, BG-08 | C4 Containers (Billing/CDR Service) |
| **FR-09** | Нотификации | Отправка уведомлений пользователям и интеграциям (email, SMS, push) о событиях | BG-02 | C4 Containers (Notification Service) |
| **FR-10** | Административный интерфейс и API | Административный интерфейс и/или API для управления конфигурацией, политиками, номерами, ролями и правами | BG-08 | C4 Containers (Provisioning Service) |

---

### FR-01. Управление пользователями и устройствами

**Описание:** Платформа должна обеспечивать регистрацию, управление профилями и устройствами пользователей, включая интеграцию с корпоративными каталогами (AD/LDAP).

**Детализация:**
- Регистрация и аутентификация пользователей через корпоративные каталоги
- Управление профилями пользователей (контакты, настройки, предпочтения)
- Регистрация и управление устройствами (веб-клиенты, мобильные приложения, SIP-телефоны)
- Синхронизация пользователей и групп с корпоративными каталогами

**Связь с архитектурой:** Реализуется через IAM Service с интеграцией корпоративных IdP (см. диаграмму C4 Containers и Sequence UC_Seq_User_Auth_Token)

---

### FR-02. Голосовая связь и телефония

**Описание:** Платформа должна поддерживать исходящие и входящие голосовые вызовы через SIP-транки и WebRTC-клиентов, а также базовые функции телефонии (удержание, перевод, конференция, голосовая почта).

**Детализация:**
- Исходящие голосовые вызовы из веб-клиентов и SIP-телефонов
- Входящие вызовы через PSTN с маршрутизацией по очередям
- Базовые функции телефонии: удержание, перевод, конференция, голосовая почта
- Поддержка различных кодеков и адаптация к качеству сети

**Связь с архитектурой:** Реализуется через Call Control Service, SIP Gateway/SBC, WebRTC Gateway (см. диаграммы C4 Containers и Sequence UC_Seq_Outgoing_Call, UC_Seq_Incoming_Call)

---

### FR-03. Видеоконференции и совместная работа

**Описание:** Платформа должна предоставлять сервис многопользовательских аудио-/видеоконференций с возможностью совместного экрана и чата конференции.

**Детализация:**
- Создание и управление видеоконференциями
- Поддержка множественных участников (до 100+ участников)
- Совместный экран и демонстрация документов
- Чат конференции и управление участниками

**Связь с архитектурой:** Реализуется через Call Control Service и Media/Recording Service (см. диаграмму C4 Containers)

---

### FR-04. Обмен сообщениями (чат)

**Описание:** Платформа должна обеспечивать обмен текстовыми и мультимедийными сообщениями между пользователями и группами, с историей чатов и поиском.

**Детализация:**
- Обмен текстовыми и мультимедийными сообщениями (1-to-1 и групповые чаты)
- История сообщений с возможностью поиска
- Доставка сообщений в реальном времени
- Синхронизация истории между устройствами

**Связь с архитектурой:** Реализуется через Messaging/Chat Service (см. диаграмму C4 Containers)

---

### FR-05. Presence и статусы пользователей

**Описание:** Платформа должна предоставлять актуальную информацию о статусе доступности пользователей (online, busy, away и т.п.) и использовать её в сценариях маршрутизации вызовов и сообщений.

**Детализация:**
- Отображение статусов пользователей (online, busy, away, offline)
- Автоматическое обновление статусов на основе активности
- Использование статусов в маршрутизации вызовов и сообщений
- Интеграция с календарями для автоматического обновления статусов

**Связь с архитектурой:** Реализуется через Presence Service (см. диаграмму C4 Containers)

---

### FR-06. Интеграция с бизнес-системами

**Описание:** Платформа должна предоставлять API/вебхуки для интеграции с CRM, Service Desk, ERP и другими системами (отображение карточки клиента, клик-ту-колл, логирование коммуникаций).

**Детализация:**
- REST API и Webhooks для интеграций
- Отображение карточки клиента при входящем звонке
- Клик-ту-колл из CRM и других систем
- Логирование коммуникаций в бизнес-системах
- Синхронизация контактов и календарей

**Связь с архитектурой:** Реализуется через API Gateway и событийную шину (см. диаграммы C4 Context и C4 Containers)

---

### FR-07. Запись разговоров и хранение записей

**Описание:** Платформа должна поддерживать запись голосовых вызовов и конференций с хранением и управлением доступом к записям.

**Детализация:**
- Запись голосовых вызовов и конференций
- Хранение записей в Object Storage
- Управление доступом к записям через политики RBAC
- Политики retention и автоматическое удаление записей

**Связь с архитектурой:** Реализуется через Media/Recording Service (см. диаграмму C4 Containers и Deployment)

---

### FR-08. Биллинг и CDR

**Описание:** Платформа должна собирать CDR-записи по всем сеансам связи и предоставлять данные для биллинга и аналитики.

**Детализация:**
- Сбор CDR-записей по всем сеансам связи (вызовы, сообщения, конференции)
- Хранение CDR в специализированной БД
- Экспорт данных для биллинга и аналитики
- Интеграция с корпоративными системами отчётности

**Связь с архитектурой:** Реализуется через Billing/CDR Service (см. диаграмму C4 Containers и Deployment)

---

### FR-09. Нотификации

**Описание:** Платформа должна отправлять уведомления пользователям и интеграциям (email, SMS, push и др.) о событиях (пропущенные вызовы, приглашения на конференции, системные алерты).

**Детализация:**
- Отправка уведомлений через различные каналы (email, SMS, push)
- Настройка предпочтений уведомлений пользователями
- Интеграция с внешними системами уведомлений
- Логирование отправленных уведомлений

**Связь с архитектурой:** Реализуется через Notification Service (см. диаграмму C4 Containers)

---

### FR-10. Административный интерфейс и API

**Описание:** Платформа должна предоставлять административный интерфейс и/или API для управления конфигурацией, политиками, номерами, ролями и правами.

**Детализация:**
- Административный интерфейс для управления пользователями и конфигурацией
- REST API для программного управления
- Управление политиками безопасности и доступа
- Управление номерами, тарифами и биллинг-параметрами

**Связь с архитектурой:** Реализуется через Provisioning Service и API Gateway (см. диаграмму C4 Containers)

---

## 6.2. Нефункциональные требования (NFR)

| ID | Требование | Метрика | Связь с бизнес-целями | Связь с архитектурными драйверами |
|----|------------|---------|----------------------|-----------------------------------|
| **NFR-01** | Масштабируемость | Поддержка до 50 000 активных пользователей, горизонтальное масштабирование | BG-04, BG-06 | AD-01 |
| **NFR-02** | Доступность | SLA 99.9% для критичных коммуникационных сервисов | BG-04 | AD-02 |
| **NFR-03** | Производительность | Время установления вызова ≤ 3 сек, задержка доставки сообщений ≤ 1 сек (P95) | BG-02 | AD-01 |
| **NFR-04** | Безопасность | TLS для внешних соединений, OAuth2.1/OIDC для аутентификации, mTLS для внутренних сервисов | BG-05 | AD-03 |
| **NFR-05** | Наблюдаемость | Метрики, логи и трассировки с корреляцией по trace-id | BG-08 | AD-05 |
| **NFR-06** | Отказоустойчивость | Отказ одного узла без потери доступности, время восстановления ≤ 5 мин | BG-04 | AD-02 |
| **NFR-07** | Сопровождаемость | Независимое развёртывание микросервисов без простоя, CI/CD | BG-06, BG-07 | AD-06 |
| **NFR-08** | Совместимость и расширяемость | Стандартизированные протоколы и форматы данных | BG-06, BG-07 | AD-04, AD-06 |
| **NFR-09** | Конфиденциальность и соответствие | Разграничение доступа к записям и CDR, политики retention | BG-05 | AD-03 |

---

### NFR-01. Масштабируемость

**Описание:** Платформа должна поддерживать масштабирование до не менее чем 50 000 активных пользователей с возможностью горизонтального масштабирования отдельных микросервисов.

**Метрики:**
- Поддержка до 50 000 активных пользователей
- Горизонтальное масштабирование отдельных микросервисов
- Автоматическое масштабирование (auto-scaling) на основе метрик нагрузки
- Эластичность при пиковых нагрузках

**Связь с архитектурой:** Реализуется через микросервисную архитектуру, горизонтальное масштабирование, stateless-сервисы (см. диаграммы C4 Containers и Deployment, ADR-001, ADR-003)

---

### NFR-02. Доступность

**Описание:** Целевой SLA для основных коммуникационных сервисов (регистрация, исходящие/входящие вызовы, чат) — не ниже 99.9% в год.

**Метрики:**
- SLA 99.9% для критичных коммуникационных сервисов
- Время восстановления после сбоя ≤ 15 минут
- Доля потерянных вызовов ≤ 0.1%

**Связь с архитектурой:** Реализуется через отказоустойчивую архитектуру, репликацию, автоматическое восстановление (см. диаграмму Deployment, ADR-005, ADR-006)

---

### NFR-03. Производительность

**Описание:** 
- Среднее время установления вызова (от нажатия «Позвонить» до получения сигнала вызова) не должно превышать 3 секунд в нормальных условиях.
- Задержка доставки чат-сообщений между пользователями в пределах одного региона не должна превышать 1 секунды в 95% случаев.

**Метрики:**
- Время установления вызова ≤ 3 сек (P95)
- Задержка доставки сообщений ≤ 1 сек (P95)
- RTT для медиапотоков ≤ 80–120 мс (P95)

**Связь с архитектурой:** Реализуется через оптимизацию критических путей, кэширование, использование WebTransport для real-time сигнализации (см. диаграммы C4 Containers и Sequence, ADR-003)

---

### NFR-04. Безопасность

**Описание:**
- Все внешние соединения должны быть защищены TLS.
- Для пользовательской и сервисной аутентификации должны использоваться стандарты OAuth2.1/OIDC.
- Внутрисервисное взаимодействие должно быть защищено посредством mTLS и централизованного управления сертификатами.

**Метрики:**
- 100% внешних соединений защищены TLS
- 100% внутрисервисных взаимодействий защищены mTLS
- Время обнаружения инцидентов безопасности ≤ 5 минут

**Связь с архитектурой:** Реализуется через IAM Service, API Gateway, mTLS, шифрование трафика (см. диаграммы C4 Context, C4 Containers, Sequence, ADR-004)

---

### NFR-05. Наблюдаемость

**Описание:** Платформа должна генерировать метрики, логи и трассировки, достаточные для анализа производительности и поиска причин инцидентов; должна быть обеспечена корреляция событий по единому trace-id.

**Метрики:**
- Время локализации корневой причины инцидента ≤ 30 минут
- Покрытие метриками всех критичных сервисов 100%
- Корреляция событий по единому trace-id

**Связь с архитектурой:** Реализуется через Observability Stack (Prometheus, Loki, Tempo/Jaeger) и интеграцию с корпоративными системами мониторинга (см. диаграмму Deployment, ADR-006)

---

### NFR-06. Отказоустойчивость и восстановление

**Описание:** Платформа должна выдерживать отказ одного узла кластера без потери доступности ключевых сервисов; время восстановления при частичном отказе не должно превышать 5 минут.

**Метрики:**
- Отказ одного узла не приводит к недоступности сервисов
- Время восстановления после сбоя ≤ 5 минут
- Доля неуспешных операций в момент отказа ≤ 1%

**Связь с архитектурой:** Реализуется через репликацию сервисов, HA-кластеры БД, автоматическое восстановление (см. диаграмму Deployment, ADR-005, ADR-006)

---

### NFR-07. Сопровождаемость

**Описание:** Архитектура должна позволять независимое развертывание и обновление микросервисов без простоя системы в целом, при наличии автоматизированных тестов и пайплайнов CI/CD.

**Метрики:**
- Время развёртывания новых функций ≤ 2 недели
- Независимое развёртывание микросервисов без простоя
- Доля неуспешных попыток установления вызовов в период обновления ≤ 0.5%

**Связь с архитектурой:** Реализуется через микросервисную архитектуру, event-driven коммуникации, версионирование API, CI/CD (см. диаграмму C4 Containers, ADR-001, ADR-002, ADR-003)

---

### NFR-08. Совместимость и расширяемость

**Описание:** Платформа должна использовать стандартизированные протоколы и форматы данных, обеспечивающие возможность подключения дополнительных клиентов и интеграций без изменения базовой архитектуры.

**Метрики:**
- Время реализации типовой интеграции ≤ 4–6 недель
- Поддержка стандартных протоколов (SIP, WebRTC, OIDC, REST, gRPC)
- Отсутствие необходимости остановки существующих сервисов при добавлении новых интеграций

**Связь с архитектурой:** Реализуется через стандартизированные протоколы, API Gateway, событийную шину (см. диаграммы C4 Context и C4 Containers, ADR-002, ADR-003)

---

### NFR-09. Конфиденциальность и соответствие

**Описание:** Платформа должна обеспечивать разграничение доступа к записям, CDR и логам, а также поддержку политики хранения (retention) и удаления данных в соответствии с требованиями регуляторов и внутренними нормативами.

**Метрики:**
- 100% несанкционированных попыток доступа блокируются
- Политики retention и автоматическое удаление данных
- Соответствие требованиям GDPR и отраслевым стандартам

**Связь с архитектурой:** Реализуется через централизованный контроль доступа (IAM Service), политики RBAC, политики retention (см. диаграмму C4 Containers, ADR-004, ADR-006)

---

## 6.3. Связь с последующими разделами

Указанные требования служат основой для:

- **Раздела 7. Пользовательские сценарии** — детализации сценариев использования для реализации функциональных требований
- **Раздела 8. Сценарии атрибутов качества** — формулирования сценариев для оценки выполнения нефункциональных требований
- **Раздела 9. Архитектурное решение** — обоснования архитектурных решений, направленных на удовлетворение требований
- **ADR** — фиксации конкретных архитектурных решений для каждого требования

Трассировка требований к решениям обеспечивает прозрачность связи между требованиями, архитектурными решениями и реализацией.
