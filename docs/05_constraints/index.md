# Ограничения

**Проект:** Платформа унифицированных коммуникаций (Unified Communications, UC) для корпоративного использования

---

## Введение

Ограничения определяют рамки, в которых должно быть реализовано архитектурное решение. Они влияют на выбор технологий, архитектурных паттернов и стратегий реализации. Ограничения делятся на бизнес-ограничения и технологические ограничения.

---

## Бизнес-ограничения

| ID | Ограничение | Описание | Влияние на архитектуру | Связь с ADR |
|----|-------------|----------|------------------------|-------------|
| **BC-01** | Ограниченный бюджет и поэтапная реализация | Проект реализуется итерационно, с поэтапным вводом функциональных доменов (голос, чат, конференции, запись, интеграции) | Требуется модульная архитектура с возможностью поэтапного развёртывания доменов | ADR-001, ADR-002 |
| **BC-02** | Минимизация влияния на текущие операции | Миграция пользователей и сервисов должна происходить поэтапно, без длительных простоев и с возможностью отката | Требуется поддержка параллельной работы старой и новой систем, blue-green deployment | ADR-005, ADR-006 |
| **BC-03** | Сохранение части существующих контрактов и решений | Некоторые операторские и телеком-решения (SBC, SIP-транки, системы записи) должны оставаться в эксплуатации до завершения сроков контрактов | Требуется интеграция с существующими системами через стандартизированные интерфейсы | ADR-002 |
| **BC-04** | Регуляторные требования и хранение данных | Данные CDR, записи разговоров и журналы аудита должны храниться в соответствии с нормативными требованиями (сроки, юрисдикция, доступ) | Влияет на выбор хранилищ, стратегию retention, политики доступа | ADR-004, ADR-006 |

---

### BC-01. Ограниченный бюджет и поэтапная реализация

**Описание:** Проект реализуется итерационно, с поэтапным вводом функциональных доменов (голос, чат, конференции, запись, интеграции), что накладывает ограничения на глубину одномоментной модернизации.

**Влияние на архитектуру:**
- Требуется модульная архитектура с чёткими границами доменов
- Возможность независимого развёртывания и развития доменов
- Минимизация зависимостей между доменами на этапе поэтапного внедрения

**Архитектурные решения:**
- Микросервисная архитектура с разделением по доменам (см. диаграмму C4 Containers)
- Event-driven коммуникации для слабой связности между доменами
- API Gateway для единой точки входа, позволяющей поэтапно добавлять новые домены

**Связь с ADR:** ADR-001 (Микросервисная архитектура), ADR-002 (API Gateway)

---

### BC-02. Минимизация влияния на текущие операции

**Описание:** Миграция пользователей и сервисов на UC-платформу должна происходить поэтапно, без длительных простоев и с возможностью отката, что ограничивает допустимые изменения в существующей инфраструктуре.

**Влияние на архитектуру:**
- Требуется поддержка параллельной работы старой и новой систем
- Возможность постепенной миграции пользователей и функций
- Стратегии развёртывания без простоя (rolling update, blue-green deployment)

**Архитектурные решения:**
- Поддержка версионирования API для обратной совместимости
- Стратегии развёртывания без простоя через Kubernetes rolling update
- Возможность отката изменений через версионирование и feature flags

**Связь с ADR:** ADR-005 (Отказоустойчивость), ADR-006 (Развёртывание)

---

### BC-03. Сохранение части существующих контрактов и решений

**Описание:** Некоторые операторские и телеком-решения (SBC, SIP-транки, системы записи) должны оставаться в эксплуатации до завершения сроков контрактов, что ограничивает выбор технологий и протоколов.

**Влияние на архитектуру:**
- Требуется интеграция с существующими системами через стандартизированные интерфейсы
- Поддержка стандартных протоколов (SIP, WebRTC) для совместимости
- Адаптеры для интеграции с проприетарными системами

**Архитектурные решения:**
- Использование стандартных протоколов (SIP, WebRTC) для максимальной совместимости
- Адаптеры и шлюзы для интеграции с существующими системами
- API Gateway для абстракции от конкретных реализаций внешних систем

**Связь с ADR:** ADR-002 (API Gateway и интеграции)

---

### BC-04. Регуляторные требования и хранение данных

**Описание:** Данные CDR, записи разговоров и журналы аудита должны храниться в соответствии с нормативными требованиями (сроки, юрисдикция, доступ), что влияет на выбор хранилищ и стратегию retention.

**Влияние на архитектуру:**
- Требования к хранению данных в определённой юрисдикции
- Политики retention и удаления данных
- Контроль доступа к чувствительным данным (CDR, записи)

**Архитектурные решения:**
- Разделение хранилищ по типам данных (OLTP для транзакций, Object Storage для записей)
- Политики retention и автоматическое удаление данных
- Централизованный контроль доступа через IAM Service
- Аудит доступа к чувствительным данным

**Связь с ADR:** ADR-004 (Безопасность), ADR-006 (Хранение данных)

---

## Технологические ограничения

| ID | Ограничение | Описание | Влияние на архитектуру | Связь с ADR |
|----|-------------|----------|------------------------|-------------|
| **TC-01** | Использование открытых стандартов и протоколов | Для минимизации vendor lock-in предпочтительны открытые стандарты: SIP, WebRTC, OAuth2.1/OIDC, REST/gRPC, AMQP/Kafka | Определяет выбор протоколов и форматов данных | ADR-002 |
| **TC-02** | Базовая инфраструктура Kubernetes/VM | Целевая среда развёртывания — Kubernetes-кластер. Допускается использование VM для компонентов, не готовых к контейнеризации | Определяет стратегию развёртывания и оркестрации | ADR-005, ADR-006 |
| **TC-03** | Совместимость с существующими каталогами и IdP | Интеграция с уже используемыми каталогами (AD/LDAP) и IdP (OIDC/SAML) без их существенной модернизации | Требуется поддержка стандартных протоколов аутентификации | ADR-004 |
| **TC-04** | Использование существующих средств мониторинга | Приоритет — интеграция в уже используемую экосистему мониторинга и SIEM | Требуется экспорт метрик и логов в стандартных форматах | ADR-006 |
| **TC-05** | Сетевые ограничения и QoS | Ограничения по полосе пропускания, задержкам и политике QoS в корпоративной сети | Влияет на выбор кодеков и схем маршрутизации медиапотоков | ADR-003 |

---

### TC-01. Использование открытых стандартов и протоколов

**Описание:** Для минимизации vendor lock-in и упрощения интеграций предпочтительны открытые стандарты: SIP, WebRTC, OAuth2.1/OIDC, REST/gRPC, AMQP/Kafka и т.п.

**Влияние на архитектуру:**
- Определяет выбор протоколов для сигнализации и медиа
- Требует использования стандартизированных форматов данных
- Обеспечивает совместимость с различными клиентами и системами

**Архитектурные решения:**
- SIP для сигнализации голосовых вызовов
- WebRTC (SRTP/DTLS) для браузерных клиентов
- OAuth2.1/OIDC для аутентификации
- REST/gRPC для синхронных API
- Kafka/RabbitMQ для асинхронных событий

**Связь с ADR:** ADR-002 (API Gateway и протоколы)

---

### TC-02. Базовая инфраструктура Kubernetes/VM

**Описание:** Целевая среда развёртывания — Kubernetes-кластер (on-prem или cloud). Допускается использование виртуальных машин для компонентов, не готовых к контейнеризации (например, отдельные SBC/медиасерверы).

**Влияние на архитектуру:**
- Определяет стратегию развёртывания и оркестрации
- Требует контейнеризации микросервисов
- Поддержка гибридного развёртывания (Kubernetes + VM)

**Архитектурные решения:**
- Контейнеризация всех микросервисов
- Развёртывание в Kubernetes-кластере с auto-scaling
- Интеграция с внешними компонентами через стандартизированные интерфейсы

**Связь с ADR:** ADR-005 (Развёртывание), ADR-006 (Инфраструктура)

---

### TC-03. Совместимость с существующими каталогами и IdP

**Описание:** UC-платформа должна интегрироваться с уже используемыми каталогами (AD/LDAP) и IdP (OIDC/SAML) без их существенной модернизации.

**Влияние на архитектуру:**
- Требуется поддержка стандартных протоколов аутентификации
- Интеграция с корпоративными каталогами через стандартные интерфейсы
- Поддержка федерации идентичности

**Архитектурные решения:**
- IAM Service с поддержкой OIDC/SAML для интеграции с IdP
- Интеграция с AD/LDAP через стандартные протоколы
- Поддержка SSO и федерации идентичности

**Связь с ADR:** ADR-004 (IAM и безопасность)

---

### TC-04. Использование существующих средств мониторинга и логирования

**Описание:** Приоритет — интеграция в уже используемую заказчиком экосистему мониторинга и SIEM; внедрение новых инструментов допустимо только как дополнение.

**Влияние на архитектуру:**
- Требуется экспорт метрик и логов в стандартных форматах
- Интеграция с существующими системами мониторинга
- Поддержка стандартных протоколов экспорта (Prometheus, Syslog, OpenTelemetry)

**Архитектурные решения:**
- Observability Stack с экспортом в стандартных форматах
- Интеграция с корпоративными SIEM через стандартные протоколы
- Поддержка OpenTelemetry для распределённой трассировки

**Связь с ADR:** ADR-006 (Наблюдаемость)

---

### TC-05. Сетевые ограничения и QoS

**Описание:** Архитектура должна учитывать наличие ограничений по полосе пропускания, задержкам и политике QoS в корпоративной сети и при выходе в Интернет, что влияет на выбор кодеков и схем маршрутизации медиапотоков.

**Влияние на архитектуру:**
- Требуется адаптация к качеству сети
- Выбор кодеков с учётом ограничений полосы пропускания
- Поддержка QoS для критичных медиапотоков

**Архитектурные решения:**
- Адаптивное качество медиа (adaptive bitrate)
- Поддержка различных кодеков (G.711, G.729, Opus)
- Маршрутизация медиапотоков с учётом QoS

**Связь с ADR:** ADR-003 (Медиа-обработка)

---

## Связь с последующими разделами

Указанные ограничения учитываются при формировании архитектурных решений (см. раздел `9. Архитектурное решение`) и обосновываются в соответствующих ADR. Они влияют на:

- **Выбор технологий и протоколов** (TC-01, TC-03)
- **Стратегию развёртывания** (TC-02, BC-02)
- **Архитектурные паттерны** (BC-01, BC-02)
- **Требования к безопасности и соответствию** (BC-04, TC-03)
- **Интеграции с внешними системами** (BC-03, TC-04)

Трассировка ограничений к решениям обеспечивает прозрачность связи между ограничениями, архитектурными решениями и реализацией.
