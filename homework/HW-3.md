## Оценка атрибутов качества для критического сценария

Критический сценарий: поиск матча и подключение к игровому серверу  
(см. диаграмму последовательности «Критический сценарий: поиск матча и подключение к игровому серверу»).

---

### 1. Производительность

#### Сценарий P1. Время поиска матча

- Стимул: игрок нажимает «Играть» во Веб-клиенте.
- Контекст: до 200 000 одновременных запросов на поиск.
- Реакция: Сервис матчмейкинга подбирает группу игроков и создаёт лобби либо возвращает таймаут.
- Характеристики:
  - время поиска матча (от запроса клиента до ответа) P95 ≤ 10 секунд;
  - алгоритм подбора не зависит от медленных внешних сервисов и использует локальные/быстрые данные.

#### Сценарий P2. Время подключения к игровому серверу

- Стимул: Веб-клиент получил параметры сервера и sessionToken.
- Контекст: до 100 игроков одновременно подключаются к одному серверу.
- Реакция: устанавливается соединение, клиент получает первый snapshot состояния.
- Характеристики:
  - время подключения (до первого snapshot) P95 ≤ 3 секунд;
  - средняя задержка (RTT) P95 ≤ 80–120 мс внутри региона.

---

### 2. Надёжность

#### Сценарий R1. Сбой игрового сервера при подключении

- Стимул: отказ игрового сервера в момент установления соединения.
- Контекст: часть игроков уже подключается к матчу.
- Реакция:
  - сервер возвращает ошибку, клиент показывает понятное сообщение;
  - Сервис наблюдаемости фиксирует рост ошибок.
- Характеристики:
  - время обнаружения аномалии ≤ 10 секунд;
  - доля матчей, прерванных по вине сервера, ≤ 0.1 % от числа запущенных матчей.

#### Сценарий R2. Недоступность Сервиса матчмейкинга

- Стимул: Сервис матчмейкинга не отвечает или возвращает ошибку.
- Контекст: игроки нажимают «Играть».
- Реакция:
  - клиент получает сообщение о временной недоступности поиска;
  - другие функции (авторизация, профиль, магазин) остаются доступными.
- Характеристики:
  - MTTR для Сервиса матчмейкинга ≤ 15 минут;
  - отказ матчмейкинга не приводит к простоям остальных сервисов.

---

### 3. Масштабируемость

#### Сценарий S1. Массовый рост запросов на поиск

- Стимул: рекламная кампания, резкий рост одновременных запросов на поиск.
- Контекст: увеличение активных запросов с 50 000 до 200 000.
- Реакция:
  - выполняется горизонтальное масштабирование Сервиса матчмейкинга;
  - время поиска остаётся в пределах SLA.
- Характеристики:
  - Сервис матчмейкинга реализован как stateless-компонент с общим быстрым хранилищем состояния;
  - добавление инстансов приводит к снижению времени ожидания, а не к росту задержек.

#### Сценарий S2. Масштабирование игровых серверов

- Стимул: рост числа активных матчей в одном регионе.
- Контекст: увеличивается нагрузка на Оркестрацию игровых серверов.
- Реакция:
  - оркестрация поднимает дополнительные игровые сервера;
  - Сервис лобби получает параметры свободных серверов.
- Характеристики:
  - добавление новых серверов происходит без простоя уже идущих матчей;
  - ограничения на количество матчей на один сервер задаются конфигурацией.

---

### 4. Модифицируемость

#### Сценарий M1. Изменение алгоритма подбора матчей

- Стимул: бизнес меняет требования к подбору (диапазон рейтинга, приоритеты, регионы).
- Контекст: система работает в продакшене.
- Реакция:
  - изменения вносятся только в Сервис матчмейкинга;
  - контракты с Веб-клиентом и Сервисом лобби остаются прежними.
- Характеристики:
  - вся логика подбора сосредоточена в одном сервисе;
  - оценка трудозатрат: S–M (от нескольких дней до 2–3 недель без каскадных изменений).

#### Сценарий M2. Добавление новой проверки античита при запуске матча

- Стимул: появляются новые требования по безопасности.
- Контекст: используется Сервис античита при выделении сервера.
- Реакция:
  - обновляется логика Сервиса античита и обработка ответа в Оркестрации игровых серверов;
  - Веб-клиент, Сервис лобби и Сервис матчмейкинга не изменяются.
- Характеристики:
  - контракт между Оркестрацией и Сервисом античита расширяемый;
  - изменения локализованы в двух сервисах.

---

### 5. Дополнительно: безопасность и наблюдаемость (кратко)

- Безопасность:
  - все подключения к игровому серверу проходят через проверку sessionToken, привязанного к playerId и matchId, с коротким TTL;
  - попытки подключиться с поддельным или просроченным токеном отклоняются.

- Наблюдаемость:
  - Сервис матчмейкинга и игровые сервера отправляют метрики (время поиска, RTT, ошибки, длительность матчей) в Сервис наблюдаемости;
  - на основе метрик настраиваются алерты по SLA (например, P95 времени поиска и RTT).